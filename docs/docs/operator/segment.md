# Сегменты

Страница **"Сегменты"** предназначена для создания и управления логикой выборки данных на основе источников и их атрибутов. Сегмент — это определённое логическое условие, которое позволяет выделить подмножество доноров по заданным правилам фильтрации.

## Основной функционал

- ✅ Добавление одного или нескольких источников данных
- ✅ Выбор атрибутов из источников
- ✅ Настройка логических условий для каждого атрибута
- ✅ Поддержка группировок условий с логическими связками `И`, `ИЛИ`, `НЕ`
- ✅ Возможность создания вложенных групп условий
- ✅ Указание ограничения расчёта — предельное количество участников сегмента
- ✅ Пересчёт сегмента в реальном времени

## Интерфейс

На странице отображаются:

- **Область редактирования сегмента**:
  - Название сегмента
  - Ограничение расчёта (число доноров, которых нужно выбрать)
  - Источники и связанные с ними атрибуты

- **Конструктор условий**:
  - Каждое условие представляет собой тройку: `атрибут`, `оператор`, `значение`
  - Доступна группировка условий с использованием `И`, `ИЛИ`, `НЕ`
  - Возможность добавлять подгруппы (вложенные блоки)

- **Список атрибутов источника**:
  - Атрибуты отображаются с понятными названиями (например: `height`, `weight`, `bloodType`, `rhFactor`)
  - При выборе атрибута становится доступна форма настройки правила

- **Действия**:
  - `Сохранить` — сохраняет текущую конфигурацию
  - `Сохранить и рассчитать` — сохраняет и выполняет расчёт сегмента по заданным условиям

## Ограничение расчёта

Сегменты могут быть ограничены по количеству участников. Это используется, например, для ограничения объёма выборки при массовых коммуникациях. Поле **"Ограничение расчёта"** определяет максимальное количество доноров, которые будут выбраны при расчёте сегмента.

## Пример

**Пример конфигурации сегмента:** Рост > 165 И Вес > 80 И (Rh-фактор == plus) ИЛИ (Группа крови == AB ИЛИ Группа крови == A)


Такой сегмент выделяет доноров, чей рост и вес превышают указанные значения, при этом они должны либо иметь положительный Rh-фактор, либо одну из указанных групп крови.

## Связь с источниками и атрибутами

Каждое условие формируется на основе **атрибута источника**. Атрибуты описываются следующей структурой:

```ts
interface IAttribute {
  id?: number;
  sourceId?: number;
  isActive: boolean;
  name?: string;
  systemName: string;
  type: DataType;
  unit: DataUnit;
  control: DataControl;
  allowedValues?: string;
}
```

Сегмент оперирует контролами (типами представления атрибута), что влияет на форму взаимодействия с пользователем:
- STRING_SELECT — выпадающий список значений
- BOOLEAN — логическое поле
- INTEGER, DATE — числовые и календарные фильтры

